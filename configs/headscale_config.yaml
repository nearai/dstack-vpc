server_url: http://localhost:8080
listen_addr: 0.0.0.0:8080
metrics_listen_addr: 127.0.0.1:9090
grpc_listen_addr: 127.0.0.1:50443

private_key_path: /var/lib/headscale/private.key
noise:
  private_key_path: /var/lib/headscale/noise_private.key

prefixes:
  v4: 100.128.0.0/10

derp:
  server:
    enabled: false
  urls:
    - https://controlplane.tailscale.com/derpmap/default
  paths: []

database:
  type: sqlite3
  sqlite:
    path: /var/lib/headscale/db.sqlite

log:
  format: text
  level: info

dns:
  override_local_dns: true
  magic_dns: true
  base_domain: dstack.internal
  nameservers:
    global:
      - 1.1.1.1
      - 1.0.0.1

unix_socket: /var/run/headscale/headscale.sock
unix_socket_permission: "0770"

# ACL policies for network access control
# Internal-only nodes can only communicate within the VPC
# External-allowed nodes can access both VPC and external networks
acls:
  # Allow internal-only nodes to only reach VPC subnet
  - action: accept
    src:
      - "tag:internal-only"
    dst:
      - "100.128.0.0/10:*"
  
  # Allow external-allowed nodes to reach VPC subnet
  - action: accept
    src:
      - "tag:external-allowed"
    dst:
      - "100.128.0.0/10:*"
  
  # Allow external-allowed nodes to reach external networks (via exit nodes if configured)
  # Note: This allows routing to external IPs, but actual external access depends on exit node configuration
  - action: accept
    src:
      - "tag:external-allowed"
    dst:
      - "*:*"
  
  # Default: Allow all nodes to communicate within VPC (for backwards compatibility)
  - action: accept
    src:
      - "100.128.0.0/10"
    dst:
      - "100.128.0.0/10:*"
